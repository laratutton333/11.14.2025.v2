import React, { useState } from 'react';
import { AlertCircle, CheckCircle, TrendingUp, Download, Share2, Loader, Info } from 'lucide-react';

export default function AIMapper() {
  const [input, setInput] = useState('');
  const [inputType, setInputType] = useState('url');
  const [analyzing, setAnalyzing] = useState(false);
  const [results, setResults] = useState(null);
  const [scoringMode, setScoringMode] = useState('dual');
  const [viewMode, setViewMode] = useState('combined');
  const [showModeInfo, setShowModeInfo] = useState(false);
  const [industry, setIndustry] = useState('');

  const industryBenchmarks = {
    'financial': { name: 'Financial Services', seo: { min: 75, max: 82 }, geo: { min: 58, max: 65 } },
    'technology': { name: 'Technology', seo: { min: 78, max: 85 }, geo: { min: 70, max: 78 } },
    'healthcare': { name: 'Healthcare', seo: { min: 68, max: 75 }, geo: { min: 55, max: 62 } },
    'retail': { name: 'Retail & E-commerce', seo: { min: 72, max: 80 }, geo: { min: 65, max: 72 } },
    'manufacturing': { name: 'Manufacturing', seo: { min: 65, max: 73 }, geo: { min: 52, max: 60 } },
    'media': { name: 'Media & Publishing', seo: { min: 80, max: 88 }, geo: { min: 68, max: 76 } },
    'professional': { name: 'Professional Services', seo: { min: 70, max: 78 }, geo: { min: 60, max: 68 } },
    'hospitality': { name: 'Hospitality & Travel', seo: { min: 74, max: 82 }, geo: { min: 62, max: 70 } },
    'education': { name: 'Education', seo: { min: 66, max: 74 }, geo: { min: 58, max: 66 } },
    'nonprofit': { name: 'Non-Profit', seo: { min: 62, max: 70 }, geo: { min: 54, max: 62 } }
  };

  const analyzeContent = async () => {
    if (!input.trim()) return;
    
    setAnalyzing(true);
    
    await new Promise(resolve => setTimeout(resolve, 3500));
    
    const mockResults = {
      seoScore: Math.floor(Math.random() * 25) + 70,
      geoScore: Math.floor(Math.random() * 30) + 55,
      seo: {
        technical: {
          score: Math.floor(Math.random() * 20) + 75,
          findings: [
            { label: 'Schema.org markup', status: 'present', impact: 'high' },
            { label: 'Page load speed', status: 'good', impact: 'high' },
            { label: 'Mobile optimization', status: 'excellent', impact: 'high' },
            { label: 'SSL/HTTPS', status: 'enabled', impact: 'medium' }
          ]
        },
        onPage: {
          score: Math.floor(Math.random() * 20) + 70,
          findings: [
            { label: 'Title tag optimization', status: 'good', impact: 'high' },
            { label: 'Meta description', status: 'present', impact: 'high' },
            { label: 'Header hierarchy', status: 'structured', impact: 'medium' },
            { label: 'Keyword placement', status: 'fair', impact: 'medium' }
          ]
        },
        content: {
          score: Math.floor(Math.random() * 20) + 65,
          findings: [
            { label: 'Word count', status: 'adequate', impact: 'medium' },
            { label: 'Readability score', status: 'high', impact: 'high' },
            { label: 'Internal linking', status: 'limited', impact: 'medium' },
            { label: 'Multimedia', status: 'present', impact: 'low' }
          ]
        }
      },
      geo: {
        llmComprehension: {
          score: Math.floor(Math.random() * 25) + 55,
          findings: [
            { label: 'Entity definitions', status: 'basic', impact: 'high' },
            { label: 'Information density', status: 'moderate', impact: 'high' },
            { label: 'Semantic markup', status: 'limited', impact: 'high' },
            { label: 'Context richness', status: 'fair', impact: 'medium' }
          ]
        },
        promptAlignment: {
          score: Math.floor(Math.random() * 30) + 50,
          findings: [
            { label: 'Q&A format', status: 'absent', impact: 'high' },
            { label: 'Conversational tone', status: 'limited', impact: 'high' },
            { label: 'Quotable statements', status: 'few', impact: 'medium' },
            { label: 'Attribution clarity', status: 'good', impact: 'medium' }
          ]
        },
        aiDiscovery: {
          score: Math.floor(Math.random() * 25) + 60,
          findings: [
            { label: 'Generative search alignment', status: 'moderate', impact: 'high' },
            { label: 'Voice search optimization', status: 'basic', impact: 'medium' },
            { label: 'AI parser accessibility', status: 'good', impact: 'high' },
            { label: 'Cross-reference potential', status: 'fair', impact: 'low' }
          ]
        }
      },
      seoRecommendations: [
        'Add more internal links to related content pages',
        'Optimize title tag length to 50-60 characters',
        'Include target keyword in first 100 words',
        'Add FAQ schema markup for rich snippet opportunities',
        'Compress images to improve page load speed'
      ],
      geoRecommendations: [
        'Add explicit entity definitions in opening paragraph',
        'Convert key information into Q&A format for prompt alignment',
        'Include quotable soundbites with clear attribution',
        'Enhance summarization clarity by front-loading key facts',
        'Add conversational headers that mirror natural language queries',
        'Structure content for easy AI extraction and synthesis'
      ],
      combinedRecommendations: [
        { text: 'Add FAQ schema markup', benefit: 'Boosts both SEO rich snippets and GEO prompt alignment', priority: 'high' },
        { text: 'Front-load key facts in opening paragraph', benefit: 'Improves SEO keyword placement and GEO entity recognition', priority: 'high' },
        { text: 'Convert sections into Q&A format', benefit: 'Creates GEO-friendly structure while maintaining SEO header hierarchy', priority: 'medium' },
        { text: 'Add clear entity definitions', benefit: 'Enhances GEO LLM comprehension with minimal SEO impact', priority: 'medium' }
      ]
    };
    
    setResults(mockResults);
    setAnalyzing(false);
  };

  const exportResults = (format = 'markdown') => {
    if (!results) return;
    
    // ...existing export code from original...
  };

  const getScoreColor = (score) => {
    if (score >= 80) return 'text-green-600';
    if (score >= 60) return 'text-yellow-600';
    return 'text-red-600';
  };

  const getScoreBg = (score) => {
    if (score >= 80) return 'bg-green-50 border-green-200';
    if (score >= 60) return 'bg-yellow-50 border-yellow-200';
    return 'bg-red-50 border-red-200';
  };

  const getScoreGap = () => {
    if (!results) return null;
    const gap = Math.abs(results.seoScore - results.geoScore);
    if (gap <= 10) return { text: 'Well balanced', color: 'text-green-600' };
    if (gap <= 20) return { text: 'Moderate gap', color: 'text-yellow-600' };
    return { text: 'Significant gap', color: 'text-red-600' };
  };

  const getBenchmarkComparison = (score, benchmarkRange) => {
    const average = (benchmarkRange.min + benchmarkRange.max) / 2;
    const diff = score - average;
    if (diff >= 10) return { text: 'Well above average', color: 'text-green-600', icon: 'ğŸ“ˆ' };
    if (diff >= 5) return { text: 'Above average', color: 'text-green-600', icon: 'â†—ï¸' };
    if (diff >= -5) return { text: 'Average', color: 'text-yellow-600', icon: 'â†’' };
    if (diff >= -10) return { text: 'Below average', color: 'text-orange-600', icon: 'â†˜ï¸' };
    return { text: 'Well below average', color: 'text-red-600', icon: 'ğŸ“‰' };
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
      <div className="max-w-6xl mx-auto p-4 md:p-8">
        {/* Header */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-3xl md:text-5xl font-bold text-slate-900 mb-3">
            ğŸ”ğŸ§  AI Mapper
          </h1>
          <p className="text-lg md:text-xl text-slate-600 italic">
            From press release to prompt-ready
          </p>
          <p className="text-sm text-slate-500 mt-2">
            Optimize for traditional search and AI discoveryâ€”in one scan
          </p>
        </div>

        {/* Mode Info Banner */}
        {showModeInfo && (
          <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mb-6">
            <div className="flex justify-between items-start mb-4">
              <h3 className="text-lg font-bold text-slate-900">Understanding Dual-Mode Scoring</h3>
              <button onClick={() => setShowModeInfo(false)} className="text-slate-500 hover:text-slate-700">âœ•</button>
            </div>
            <div className="grid md:grid-cols-2 gap-4 text-sm">
              <div>
                <div className="font-bold text-blue-900 mb-2">ğŸ” SEO Mode</div>
                <p className="text-slate-700">Evaluates traditional search engine optimization: metadata, keywords, backlinks, page speed, mobile-friendliness, and schema markup.</p>
              </div>
              <div>
                <div className="font-bold text-purple-900 mb-2">ğŸ§  GEO Mode</div>
                <p className="text-slate-700">Evaluates AI discoverability: LLM comprehension, prompt alignment, entity definitions, conversational structure, and generative search readiness.</p>
              </div>
            </div>
          </div>
        )}

        {/* Input Section */}
        <div className="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-6">
          <div className="flex items-center justify-between mb-4">
            <div className="flex gap-4">
              <button
                onClick={() => setInputType('url')}
                className={`px-4 py-2 rounded-lg font-medium transition ${
                  inputType === 'url'
                    ? 'bg-blue-600 text-white'
                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                }`}
              >
                URL
              </button>
              <button
                onClick={() => setInputType('text')}
                className={`px-4 py-2 rounded-lg font-medium transition ${
                  inputType === 'text'
                    ? 'bg-blue-600 text-white'
                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                }`}
              >
                Paste Text
              </button>
            </div>
            <button
              onClick={() => setShowModeInfo(!showModeInfo)}
              className="p-2 hover:bg-slate-100 rounded-lg transition"
              title="Learn about scoring modes"
            >
              <Info size={20} className="text-slate-600" />
            </button>
          </div>

          <textarea
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder={
              inputType === 'url'
                ? 'https://example.com/press-release'
                : 'Paste your content here...'
            }
            className="w-full h-32 p-4 border-2 border-slate-200 rounded-xl focus:border-blue-500 focus:outline-none resize-none"
          />

          <div className="mt-4 mb-4">
            <label className="block text-sm font-medium text-slate-700 mb-2">Analysis Mode</label>
            <div className="flex gap-2">
              <button
                onClick={() => setScoringMode('seo')}
                className={`flex-1 px-4 py-3 rounded-lg font-medium transition ${
                  scoringMode === 'seo'
                    ? 'bg-blue-600 text-white'
                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                }`}
              >
                ğŸ” SEO Only
              </button>
              <button
                onClick={() => setScoringMode('geo')}
                className={`flex-1 px-4 py-3 rounded-lg font-medium transition ${
                  scoringMode === 'geo'
                    ? 'bg-purple-600 text-white'
                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                }`}
              >
                ğŸ§  GEO Only
              </button>
              <button
                onClick={() => setScoringMode('dual')}
                className={`flex-1 px-4 py-3 rounded-lg font-medium transition ${
                  scoringMode === 'dual'
                    ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white'
                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                }`}
              >
                ğŸ“Š Dual Mode
              </button>
            </div>
          </div>

          <div className="mt-4 mb-4">
            <label className="block text-sm font-medium text-slate-700 mb-2">
              Industry (Optional)
            </label>
            <select
              value={industry}
              onChange={(e) => setIndustry(e.target.value)}
              className="w-full p-3 border-2 border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none bg-white"
            >
              <option value="">Select industry...</option>
              {Object.entries(industryBenchmarks).map(([key, data]) => (
                <option key={key} value={key}>{data.name}</option>
              ))}
            </select>
          </div>

          <button
            onClick={analyzeContent}
            disabled={analyzing || !input.trim()}
            className="w-full mt-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2"
          >
            {analyzing ? (
              <>
                <Loader className="animate-spin" size={20} />
                Analyzing...
              </>
            ) : (
              <>
                <TrendingUp size={20} />
                Run Analysis
              </>
            )}
          </button>
        </div>

        {/* Results Section */}
        {results && (
          <div className="space-y-6">
            <div className="grid md:grid-cols-2 gap-6">
              <div className={`rounded-2xl shadow-lg p-8 border-2 ${getScoreBg(results.seoScore)}`}>
                <h2 className="text-2xl font-bold text-slate-900 mb-4">ğŸ” SEO Score</h2>
                <div className={`text-6xl font-bold ${getScoreColor(results.seoScore)} mb-2`}>
                  {results.seoScore}/100
                </div>
              </div>

              <div className={`rounded-2xl shadow-lg p-8 border-2 ${getScoreBg(results.geoScore)}`}>
                <h2 className="text-2xl font-bold text-slate-900 mb-4">ğŸ§  GEO Score</h2>
                <div className={`text-6xl font-bold ${getScoreColor(results.geoScore)} mb-2`}>
                  {results.geoScore}/100
                </div>
              </div>
            </div>

            <div className="flex justify-center gap-4">
              <button
                onClick={() => exportResults('markdown')}
                className="px-8 py-4 bg-slate-900 text-white rounded-xl font-semibold hover:bg-slate-800 transition flex items-center gap-2"
              >
                <Download size={20} />
                Export as Markdown
              </button>
              <button
                onClick={() => exportResults('html')}
                className="px-8 py-4 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition flex items-center gap-2"
              >
                <Download size={20} />
                Export as HTML
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
